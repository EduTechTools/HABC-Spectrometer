# Background on the Civil Air Patrol High Altitude Balloon Challenge
139 CAP squadrons from all eight regions submitted over 650 science projects to be flown to the edge of space and back! See the [National website](https://www.gocivilairpatrol.com/programs/aerospace-education/cadets/cap-national-high-altitude-balloon-challenge) for details and video fo the flight

# Background on the development of our experiement
Davis-Monthan Composite Squadron was excited to participate in the High Altitude Balloon Challege. The squadron has just recently begun to meet in-person again and this was a great hands-on activity for the cadets who had not had the opportunity to see all that CAP has to offer in terms of Aerospace Education. had such a great time exploring the potential questions and experiments that we could have pursued during the flight.  While we did this activity as a whole squadron (41 cadets), there were a few that really engaged deeply in the project and helped to both define our experiment and put together our results.  It was a great project for us and I hope our squadron will be able to participate again.

Following the guidance from StratoStar, we reviewed previous experiments and cadets filtered potential experiments to something involving plant science, material science, or something involving food.  A previous experiment flown by StratoStar with UV sensative beads was interesting to a majority of cadets.  We looked at what the previous group had done and their section on improvements they would make and came up with a plan to fly a camera that could observe the beads during flight.  We were unable to find a camera that would fit in the capsule, last the length of the flight, or meet the weight restrictions (40g) for each capsule.  The Aerospace Education Officer (AEO) leading this activity had experience with electronics and proposed using a spectrometer to record color and light levels as seen through the beads.

The sensor in our package was an AS7341 by AMS that [Adafruit](https://adafruit.com) has on a [breakout board](https://www.adafruit.com/product/4698).  Borrowing from Adafruit’s description, the sensor is a "multi-channel spectrometer which is a special type of light sensor that is able to detect not only the amount of light present, but also the amounts of light within different wavelengths. The AS7341 packs ... 16 different sensors that can detect 8 separate, overlapping bands of colored light."

We were flying the [UV sensitive beads](https://www.amazon.com/dp/B01H38O6Y2) used in previous flights with StratoStar.  After the cadets experimented with the beads at our squadron - with a regular flashlight and a UV flashlight - they came up with the hypothesis that, as the balloon went up, the amount of UV light would increase causing the beads to become more opaque - blocking the sensor and lowering the light values observed.  

Our AEO is an electronics tinkerer and provided the engineering on the project.  Some of our cadets that were specifically interested in the code used and we went over the code line-by-line at a squadron meeting (probably putting 80% of the room to sleep but for that 20%, it was awesome.)  

The next challenge was how to store the data in a way that would let the battery die and still be able to retrieve the data when the experiments were returned to us.  Adafruit has an [FRAM breakout](https://www.adafruit.com/product/1895), 'ferroelectric’ RAM, the key property of which is that it does not lose the data when power is lost, on a breakout board that uses i2c to communicate with the main brain of the project.  The AS7341 sensor breakout is also i2c so the whole thing was mostly plug and play.  

For the brain, I used an Adafruit [QT Py with an RP2040](https://www.adafruit.com/product/4900) chip.  This is a Circuit Python compatible board with what Adafruit calls a STEMMA QT connector that lets you daisy chain all of the i2c devices together (The sensor has two of these connectors so you just plug the QT Py in one end and the FRAM module, which I wired to have the same connector, in the other and we have a circuit).  

Finally, how to power the thing? With a 40g limit, weight was our enemy.  [Oak Dev Tech](https://www.oakdev.tech/#/), made a LiPo battery supplier and charger specifically for the QT Py (which looks to no longer be available). We soldered the two together and we had a way to power the experiment and charge the battery!  The only other soldering was installing a switch so that StratoStar could turn on our capsule at the time of the launch.  We were very excited to see Jason (StratoStar CEO) turn on our experiment during the live stream!

Because we were flying a second experiment (involving eyes of potatoes that didn’t go well and we won’t speak of again), we couldn’t have a very large LiPo.  I don’t know if it was the delay between charging it here in Tucson and flying the experiment, or if the mAh available was just too small, but we only captured 55 minutes of data.  The code (see the file in this repo) captured the sensor values every 10 seconds during the flight and stored it to the FRAM.  When the package is powered up, it sleeps for 60 seconds to give me time to set up the data dump.  Then it dumps the data and sleeps again for 30 seconds.  All of these delays are to ensure that we didn’t overwrite the data we captured on flight.  I was nervous when I saw that the switch was actually above the height of the package on the balloon.  I didn’t know if it would be accidentally cycled when it returned to the ground, overwriting our data!  (So having the battery dead actually worked in our favor). 

All of our [data is available](https://docs.google.com/spreadsheets/d/17e2CX1ekGO7Oqu9oj_XttCmlho-aXPk1/edit?usp=sharing&ouid=112217039803762428116&rtpof=true&sd=true)

What we discovered in looking at the data was that in certain wavelengths, we maxed out the sensor.  Looking at 480nm/Blue for instance, the max value of 65535 is achieved regularly during the flight (nice bright sunny day for you).  You will also see that there is a wide fluctuation in values.  The cadets attributed it to the spinning of the payload carriers and when we were in direct sunlight, the sensor was maxed out.  This led to one of the cool “How we would do it better” moments at our meeting where we reviewed the data (more on that later).  The 415nm / Violet range is what we were most interested in.  We never maxed out in that band so we have a pretty good capture of the highest and lowest values seen.  In my head an experiment that would prove the hypothesis would see a series of low values as the beads were exposed to more UV and would darken as a result.  All of the beads we chose to fly turn a dark blue/purple when exposed to UV (other beads turn pink and other colors).  50 minutes into the flight (3020 seconds) we dropped down from a reading of 36085 to 8409 and even lower to 4822 and stayed near that level for a full minute, returning to 37226 at a little over 51 minutes (3080 seconds).  All the bands show that similar reduction in light getting to the sensor.  Was this our proof?  If so, why did it go back up? (our assumption being that once UV exposure increased because of the reduction of atmosphere, it would stay that way until the balloon came back down).  This observation lit a fire under a number of the cadets and they went looking to see what altitude we were at the time of the reading (56860 ft) and the pressure readings (1.334 PSI).  In observing how the beads and sensor were packed into the capsule, they decided that it might have been that a bead or beads covered the sensor but subsequently shifted again to expose the sensor more fully to the ambient light.  The beads were not secured to the sensor and were free to move around within the width of the capsule.  At the end of the day we felt that we didn’t have data to support our hypothesis but it led to a GREAT discussion about what we could do better next time.

Our cadets came up with the following improvements: 

*First, we would test the life of battery to make sure it lasts the full 3 hours.* This was my error.  In testing the electronics, I always accelerated the tests to ensure the FRAM would be able to write the full 32K of available space and NOT loop back around to overwrite if we maxed out the available RAM.  I did this by removing the sleep commands in the code so it could complete a full write cycle in about a minute.  My early experiments with the battery were just with the QT Py and not with the sensor and FRAM.  I never let the package run for a full three hours.  I owned up to this mistake to the cadets and we talked about how to mitigate it in a future experiment.  Also discussed was using a larger battery (weight!) and suggesting to you to provide USB power on future flight hardware (which is just shifting the weight to you, we fully admit)

*Second, ensure that all the beads are exposed to light regardless of the spinning of the payload.*  We had talked about 3D printing a housing for the sensor and beads but dropped the idea when we did an initial weight for the electronics, beads, and second experiment.  We need some way of ensuring the sensor is reading its values THROUGH the bead. This led to a third change the cadets thought of...

*Filter the sensor so there is minimal peaking of max light exposure.*  Some of the photographers among the cadets said we needed a neutral density filter to ensure that we didn’t peak the readings.  I wonder if gluing a bead on top of the sensor wouldn’t do the trick.

*Finally, make experiments prior to the flight to determine which color of bead has the longest lasting color change.*  There was discussion about the beads we selected to fly and if some of them would keep their color change longer that the others, resulting in a better chance of capturing the change at the 10-second intervals.
